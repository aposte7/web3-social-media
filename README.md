# Web3 Social Media Contracts

Smart contracts for a minimal on-chain social media protocol built on Ethereum-compatible networks. The system is split into two core contracts:

-   `ProfileManager`: Handles user profiles and usernames.
-   `PostManager`: Handles posts, comments, and likes, linked to profiles.

## Contracts Overview

### ProfileManager

Manages user identities for the dApp.

**Key features**

-   Create a profile with `username`, `bio`, and `avatarURI`.
-   Enforces unique usernames and a minimum username length.
-   Update profile info (username, bio, avatar URI).
-   Query profile data by address and list all profiles.

**Main functions**

-   `createProfile ` – Creates a new profile for `msg.sender`.
-   `updateProfile` – Updates the caller's profile.
-   `getProfileId` – Returns the numeric profile ID for a user.
-   `getProfile` – Returns profile details for a wallet address.
-   `getMyProfile` – Convenience getter for the caller's profile.
-   `getAllProfiles` – Returns all profiles.
-   `totalProfiles` – Total number of created profiles.

### PostManager

Manages posts, comments and likes.

`PostManager` depends on `ProfileManager` to resolve `msg.sender` to a `profileId`. It is constructed with the `ProfileManager` contract address.

**Data types**

-   `Post` – `{ ownerId, postId, content, createdAt, isDeleted }`
-   `Comment` – `{ commentId, postId, authorId, content, createdAt, isDeleted }`

**Main features**

-   Create, edit, soft-delete posts.
-   Comment on posts, edit comments, soft-delete comments.
-   Paginated comment retrieval per post.
-   Like/unlike posts and query like counts / like status.

**Main functions**

-   `createPost` – Create a post for the caller's profile.
-   `getPostById` – Fetch a single post.
-   `getPostsByUser` – Get all posts for a given profile ID.
-   `getTotalPostCount` – Total posts ever created (including deleted).
-   `editPost` – Edit own post.
-   `deletePost` – Soft-delete own post.
-   `commentOnPost` – Add comment.
-   `editComment` – Edit own comment.
-   `deleteComment` – Soft-delete own comment.
-   `getCommentsByPost` – Paginated comments.
-   `getPostCommentCount` – Number of comments for a post.
-   `togglePostLike` – Like/unlike a post (per profile).
-   `getPostLikeCount` – Total likes on a post.
-   `hasUserLikedPost` – Whether a profile has liked a post.

## Events

### ProfileManager

-   `ProfileCreated(profileId, owner, username, bio, avatarURI, createdAt)`
-   `ProfileUpdated(profileId, updatedAt)`

### PostManager

-   `PostCreated(postId, ownerId, ownerAddress, content, createdAt)`
-   `PostEdited(postId, newContent, editedAt)`
-   `PostDeleted(postId, deletedAt)`
-   `PostLiked(postId, userId, userAddress, createdAt)`
-   `PostUnliked(postId, userId, userAddress, removedAt)`
-   `CommentCreated(commentId, postId, authorId, authorAddress, content, createdAt)`
-   `CommentEdited(commentId, newContent, editedAt)`
-   `CommentDeleted(commentId, deletedAt)`

## Build Artifacts

The `artifacts/` directory contains compiled contract ABIs and metadata (e.g. `PostManager.json`, `ProfileManager.json`) generated by the tooling (e.g. Hardhat/Foundry). These files are used by the frontend / deployment scripts.

## Deployment

Below is a generic Hardhat-style deployment flow. Adapt to your toolchain if different.

1. Deploy `ProfileManager`.
2. Deploy `PostManager` with the `ProfileManager` address:
    - e.g. `new PostManager(profileManagerAddress)`.
3. Hook your frontend to the deployed addresses and ABIs in `artifacts/`.

## Usage Notes

-   A user must first create a profile via `ProfileManager.createProfile` before interacting with `PostManager` (creating posts, commenting, liking).
-   Deletions are _soft_ (marked via `isDeleted`) so off-chain indexers can still see historical data.
-   Access control is enforced by checking `profileId` ownership in `PostManager` and by mapping wallet → profile in `ProfileManager`.

## License

This project is licensed under the MIT license, as declared in the Solidity source headers.
